# æ ¹æ“šç™½å¤©æˆ–å¤œæ™šé¡¯ç¤ºä¸åŒçš„ä¸»é¡Œé…è‰²

è«‹å°‡ [`./src/utils/helpers.js`](https://github.com/pjchender/learn-react-from-hook-realtime-weather-app/blob/get-moment-from-sunrise-sunset/src/utils/helpers.js) ä¸­çš„ç¨‹å¼å…§å®¹ï¼Œè¤‡è£½ä¸€ä»½åˆ°è‡ªå·±æœ¬æ©Ÿå°ˆæ¡ˆä¸­ã€‚

## å–®å…ƒä¸­ç¶²å€

- [æ—¥å‡ºæ—¥æ²’æ™‚åˆ»-å…¨è‡ºå„ç¸£å¸‚å¹´åº¦é€æ—¥æ—¥å‡ºæ—¥æ²’æ™‚åˆ»è³‡æ–™](https://opendata.cwb.gov.tw/dataset/astronomy/A-B0062-001) @ ä¸­å¤®æ°£è±¡å±€

## æ›´æ–°æ—¥å‡ºèˆ‡æ—¥è½è³‡æ–™

ç”±æ–¼ä¸­å¤®æ°£è±¡å±€æä¾›çš„æ—¥å‡ºæ—¥è½æ™‚é–“è³‡æ–™æœ‰é™ï¼ˆé€šå¸¸æ˜¯å…©å¹´å…§ï¼‰ï¼Œæ‰€ä»¥ä¸€æ—¦éäº†é€™å€‹æ™‚é–“å°±éœ€è¦é‡æ–°æŠ“å–ã€‚é€™è£¡å·²ç¶“å¯«å¥½å°æ‡‰çš„æŒ‡ä»¤ä¾†è‡ªå‹•æ›´æ–°ï¼Œä½¿ç”¨è€…åªéœ€è¦ï¼š

1. åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„å»ºç«‹ `.env` ä¸¦ä¸”æ”¾å…¥ API æˆæ¬Šç¢¼

```
# .env
REACT_APP_API_AUTHORIZATION_KEY=CWB-***-***
```

2. æ¥è‘—å³å¯é€éä¸‹è¿°æŒ‡ä»¤è‡ªå‹•æ›´æ–°è³‡æ–™ï¼š

```bash
$ npm run build:sunrise-sunset
```

å¦‚æœæƒ³è¦æ‰‹å‹•æ›´æ–°æª”æ¡ˆï¼Œå‰‡å¯ä»¥ï¼š

1. åˆ°ä¸­å¤®æ°£è±¡å±€ç¶²ç«™æŠ“å–ã€Œ[æ—¥å‡ºæ—¥è½æ™‚åˆ»](https://opendata.cwb.gov.tw/dataset/astronomy/A-B0062-001)ã€çš„è³‡æ–™ï¼Œä¸¦å°‡è³‡æ–™å­˜æª”åˆ° `src/scripts/generateSunriseAndSunsetData/A-B0062-001.json`

2. åŸ·è¡Œ `npm run build:process-sunrise-sunset`ï¼ŒåŸ·è¡Œå®Œç•¢å¾Œï¼Œå°±å¯ä»¥åœ¨ `src/utils/` ä¸­æœ‰ä¸€ä»½ `sunrise-sunset.json` æª”æ¡ˆï¼Œé€™æª”æ¡ˆå°±æ˜¯æˆ‘å€‘è¦çš„æ—¥å‡ºæ—¥è½æ™‚é–“è³‡æ–™ã€‚

## è£œå……å…§å®¹

### å–å¾—æ—¥å‡ºèˆ‡æ—¥è½è³‡æ–™

æ—¢ç„¶è¦åšæˆ‘å€‘å°±åšå¾—ç²¾æº–ä¸€äº›ã€‚é€™è£¡æˆ‘å€‘ç™¼ç¾ä¸­å¤®æ°£è±¡å±€é›–ç„¶æ²’æœ‰æä¾›æŸ¥è©¢æ—¥å‡ºæ—¥è½çš„ APIï¼Œä½†æ˜¯åœ¨ã€Œè³‡æ–™ä¸»é¡Œã€çš„ã€Œå¤©æ–‡ã€ä¸­ï¼Œæœ‰æä¾›ã€Œ[æ—¥å‡ºæ—¥æ²’æ™‚åˆ»-å…¨è‡ºå„ç¸£å¸‚å¹´åº¦é€æ—¥æ—¥å‡ºæ—¥æ²’æ™‚åˆ»è³‡æ–™](https://opendata.cwb.gov.tw/dataset/astronomy/A-B0062-001)ã€çš„ JSON æª”å¯ä»¥ä¸‹è¼‰ï¼š

[https://opendata.cwb.gov.tw/dataset/astronomy/A-B0062-001](https://opendata.cwb.gov.tw/dataset/astronomy/A-B0062-001)

![imgur](https://i.imgur.com/XC5th0T.png)

ä¸‹è¼‰å¾Œæœƒç™¼ç¾é€™åŒ…æª”æ¡ˆè³‡æ–™é‚„è »å¤§çš„ï¼Œé€™å€‹ JSON ç‰©ä»¶ä¸­æˆ‘å€‘éœ€è¦ç”¨åˆ°çš„æ—¥å‡ºæ—¥è½è³‡æ–™ä¸»è¦åœ¨ `dataset.locations.location` ä¸­ï¼š

![imgur](https://i.imgur.com/DhPAd2e.png)

`location` é€™å€‹é™£åˆ—ä¸­åŒ…å«å°ç£å„åœ°å€æ—¥å‡ºå’Œæ—¥è½çš„æ™‚é–“ï¼Œè€Œé™£åˆ—å…ƒç´ ä¸­ï¼ˆä¾‹å¦‚ï¼Œæ–°åŒ—å¸‚ï¼‰çš„ `time` æ¬„ä½ä¸­åŒ…å«å…©å€‹å±¬æ€§ï¼Œåˆ†åˆ¥æ˜¯ `dataTime` å’Œ `parameter`ã€‚å¾ `dataTime` å¯ä»¥çœ‹åˆ°é€™ä»½è³‡æ–™å‡½æ‹¬çš„æ™‚é–“å¾ 2020 å¹´çš„é–‹å§‹ï¼Œä¸€ç›´åˆ° 2022 å¹´çš„çµæŸï¼Œä¹Ÿå°±æ˜¯èªªé€™ä»½æª”æ¡ˆè‡³å°‘å¯ä»¥ä½¿ç”¨ 2 å¹´çš„æ™‚é–“ã€‚

> ğŸ’¡ä¸­å¤®æ°£è±¡å±€æ¯éš”ä¸€æ®µæ™‚é–“æœƒæ›´æ–°é€™ä»½æª”æ¡ˆï¼Œè®“ä½¿ç”¨è€…å¯ä»¥å–å¾—æœªä¾†æ›´ä¹…å¾Œçš„æ—¥å‡ºæ—¥è½æ™‚é–“ã€‚

åœ¨ `parameter` å±¬æ€§ä¸­å‰‡å¯ä»¥çœ‹åˆ°ï¼Œå®ƒä¸åªåˆ—å‡ºäº†ã€Œæ—¥å‡ºã€ã€ã€Œæ—¥è½ã€æ™‚é–“ï¼Œé‚„åˆ—å‡ºã€Œæ°‘ç”¨æ›™å…‰ã€ã€ã€Œæ–¹ä½ã€ã€ã€Œä»°è§’ã€...ç­‰è³‡è¨Šã€‚

### éæ¿¾å‡ºéœ€è¦ä½¿ç”¨çš„è³‡æ–™

å…¶å¯¦åœ¨é€™éº¼å¤šçš„è³‡æ–™ä¸­ï¼Œæˆ‘å€‘åªéœ€è¦æ—¥å‡ºå’Œæ—¥è½çš„è³‡æ–™ï¼Œå¾ˆå¤šé¡å¤–çš„è³‡è¨Šæ˜¯ç”¨ä¸åˆ°çš„ï¼Œå› æ­¤æ¥ä¸‹ä¾†æˆ‘å€‘è¦å¾é€™ä»½è³‡æ–™ä¸­éæ¿¾å‡ºã€Œå°ç£å¥½å¤©æ°£ Appã€çœŸæ­£éœ€è¦ç”¨å¾—åˆ°çš„è³‡æ–™ï¼Œé€™å€‹éç¨‹æœƒæ¯”è¼ƒç‘£ç¢ä¸€äº›ï¼Œè€Œä¸”å’Œ React çš„å­¸ç¿’ä¸Šä¸¦æ²’é€™éº¼ç›´æ¥çš„é—œä¿‚ï¼Œè‹¥ç›®å‰å°æ–¼é€™å€‹éƒ¨åˆ†æ²’èˆˆè¶£çš„è©±ï¼Œå¯ä»¥ç›´æ¥è·³éï¼Œæœ€å¾Œæœƒé™„ä¸Šéæ¿¾å¾Œçš„è³‡æ–™ã€‚

é€™è£¡å…ˆåœ¨å°ˆæ¡ˆä¸­çš„ `src` è³‡æ–™ä¸­åœ¨æ–°å¢ä¸€å€‹ `scripts/generateSunriseAndSunsetData` è³‡æ–™å¤¾ï¼Œä¸¦æŠŠå¾ä¸­å¤®æ°£è±¡å±€ã€Œ[æ—¥å‡ºæ—¥æ²’æ™‚åˆ»-å…¨è‡ºå„ç¸£å¸‚å¹´åº¦é€æ—¥æ—¥å‡ºæ—¥æ²’æ™‚åˆ»è³‡æ–™](https://opendata.cwb.gov.tw/dataset/astronomy/A-B0062-001)ã€ä¸‹è¼‰å¥½çš„è³‡æ–™å­˜æ”¾åœ¨å…§ã€‚

æ¥è‘—åŒæ¨£åœ¨ `generateSunriseAndSunsetData` è³‡æ–™å¤¾ä¸­ï¼Œæ–°å¢ä¸€å€‹åç‚º `process-sunrise-and-sunset.mjs` çš„æª”æ¡ˆï¼Œæˆ‘å€‘å°‡é€éé€™å€‹æª”æ¡ˆä¾†éæ¿¾å‡ºæˆ‘å€‘éœ€è¦çš„è³‡æ–™ã€‚é€™æ”¯ç¨‹å¼å…§å®¹ä¸¦ä¸æ˜¯æœ¬æ›¸çš„é‡é»ï¼Œè®€è€…åƒ…éœ€çŸ¥é“é€éé€™æ”¯æª”æ¡ˆï¼Œæœƒé€²è¡Œä»¥ä¸‹çš„éæ¿¾ï¼š

- `dataTime` çš„æ¬„ä½éœ€è¶…éåŸ·è¡Œç¨‹å¼çš„æ—¥æœŸï¼Œå› ç‚ºæˆ‘å€‘ä¸éœ€è¦æ›´æ—©ä»¥å‰çš„æ—¥å‡ºæ—¥è½æ™‚é–“
- `parameter` åªä¿ç•™ã€Œæ—¥å‡ºæ™‚åˆ»ã€å’Œã€Œæ—¥è½æ™‚åˆ»ã€

![Imgur](https://i.imgur.com/OA50qrs.png)

éæ¿¾å¾Œçš„çµæœä¿å­˜åœ¨ `./src/utils` è³‡æ–™å¤¾ä¸­ï¼Œåç‚º `sunrise-sunset.json` çš„æª”æ¡ˆï¼Œå¾é€™æ”¯æª”æ¡ˆä¸­å°±å¯ä»¥å–å¾—æ¯ä¸€å€‹åŸå¸‚æ¯ä¸€å¤©çš„æ—¥å‡ºå’Œæ—¥è½æ™‚é–“ã€‚

è‹¥å°æ–¼é€™æ”¯æª”æ¡ˆæœ‰èˆˆè¶£çš„è®€è€…ï¼Œå¯ä»¥åˆ°ä¸‹æ–¹é€£çµæª¢è¦–åŸå§‹ç¢¼ï¼š

[https://github.com/pjchender/learn-react-from-hook-realtime-weather-app/blob/get-moment-from-sunrise-sunset/src/scripts/generateSunriseAndSunsetData/process-sunrise-and-sunset.mjs](https://github.com/pjchender/learn-react-from-hook-realtime-weather-app/blob/get-moment-from-sunrise-sunset/src/scripts/generateSunriseAndSunsetData/process-sunrise-and-sunset.mjs)

æˆ‘å€‘ä¹Ÿåœ¨å°ˆæ¡ˆçš„ `package.json` ä¸­åŠ å…¥å°æ‡‰çš„æŒ‡ä»¤

```js
 // package.json
 "scripts": {
    ...
    "build:process-sunrise-sunset": "node src/scripts/generateSunriseAndSunsetData/process-sunrise-and-sunset.mjs",
  },
```

æœªä¾†åªéœ€è¦ä¸‹è¼‰æ–°çš„æ—¥å‡ºæ—¥è½æª”æ¡ˆï¼ŒåŒæ¨£æ”¾åœ¨ `/scripts/generateSunriseAndSunsetData` è³‡æ–™å¤¾ä¸­ï¼Œæ¥è‘—é€²åˆ°å°ˆæ¡ˆå¾Œï¼Œé€éçµ‚ç«¯æ©Ÿè¼¸å…¥ `build:process-sunrise-sunset` å¾Œï¼Œå°±å¯ä»¥ç”¢ç”Ÿ `sunrise-sunset.json` çš„æª”æ¡ˆã€‚
